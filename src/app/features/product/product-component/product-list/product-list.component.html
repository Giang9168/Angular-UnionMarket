<div class="table-header-controls">
    <h2>Danh sách sản phẩm</h2>
    <button class=" btn btn-primary" (click)=" add()">
        <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" viewBox="0 0 16 16">
            <path
                d="M8 4a.5.5 0 0 1 .5.5v3h3a.5.5 0 0 1 0 1h-3v3a.5.5 0 0 1-1 0v-3h-3a.5.5 0 0 1 0-1h3v-3A.5.5 0 0 1 8 4z" />
        </svg> Thêm mới
    </button>
</div>


<ng-container *ngIf="products.data && products.data.length > 0;else noData">



    <div class="mat-elevation-z8 table-container">
        <table mat-table [dataSource]="products" matSort class="compact-table">

            <ng-container matColumnDef="id">
                <th mat-header-cell *matHeaderCellDef mat-sort-header>ID</th>
                <td mat-cell *matCellDef="let element">{{element.id}}</td>
            </ng-container>

            <ng-container matColumnDef="name">
                <th mat-header-cell *matHeaderCellDef mat-sort-header>Tên</th>
                <td mat-cell *matCellDef="let element">{{element.name}}</td>
            </ng-container>
            <ng-container matColumnDef="mota">
                <th mat-header-cell *matHeaderCellDef mat-sort-header>Mô Tả</th>
                <td mat-cell *matCellDef="let element">{{element.description}}</td>
            </ng-container>
            <ng-container matColumnDef="price">
                <th mat-header-cell *matHeaderCellDef mat-sort-header> Giá</th>
                <td mat-cell *matCellDef="let element">{{element.price}}</td>
            </ng-container>

            <ng-container matColumnDef="actions">
                <th mat-header-cell *matHeaderCellDef mat-sort-header>Hành động</th>
                <td mat-cell *matCellDef="let element">
                    <div class="action-cell" style="display: flex; gap: 12px;">
                        <i class="fas fa-info" style="color: blue;" (click)="detail(element.id)"></i>
                        <i class="fas fa-pen" style="color: yellow;" (click)="update(element)"></i>
                        <i class="fas fa-trash" style="color: red;" data-bs-toggle="modal"
                            data-bs-target="#xacNhanXoaModal" (click)="prepareDelete(element.id)"></i>
                    </div>
                </td>
            </ng-container>

            <tr mat-header-row *matHeaderRowDef="displayedColumns;sticky: true"></tr>
            <tr mat-row *matRowDef="let row; columns: displayedColumns;"></tr>
        </table>


    </div>



    <div *ngIf="isFormVisible" class="modal-overlay">
        <div class="modal-content">
            <app-product-form [initialData]="selectedProduct" (productSaved)="handleSave($event)"
                (cancelled)="onFormCancelled()">
            </app-product-form>
        </div>
    </div>


    <div *ngIf="isFormDetailVisible" class="modal-overlay">
        <div class="modal-content">
            <app-product-detail [id]="selectId" (closeDetail)="close()"></app-product-detail>
        </div>
    </div>
</ng-container>

<ng-template #noData>
    <p>Không có sản phẩm nào để hiển thị.</p>
</ng-template>

<mat-paginator [pageSize]="10" [pageSizeOptions]="[10,20]" showFirstLastButtons></mat-paginator>
<div class="modal fade" id="xacNhanXoaModal" tabindex="-1" aria-labelledby="xacNhanXoaModalLabel" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="xacNhanXoaModalLabel">⚠️ Xác nhận xóa sản phẩm</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
                Bạn có chắc chắn muốn xóa sản phẩm này không?
                <br>
                <strong>Hành động này không thể hoàn tác!</strong>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Hủy</button>

                <button type="button" class="btn btn-danger" (click)="confirmDelete()" data-bs-dismiss="modal">
                    Xác nhận xóa
                </button>
            </div>
        </div>
    </div>
</div>